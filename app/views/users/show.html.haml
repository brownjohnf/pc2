.container
  .row
    .span3
      = render 'shared/menu'
    .span7
      = render 'menu'
      %h1
        = flag_icon(@user.country)
        = @user.name
        %small= render 'shared/tags', :tags => @user.tag_list
      %hr
      .tabbable.tabs-right
        %ul.nav.nav-tabs
          %li.active= link_to 'Basic', '#user', 'data-toggle' => 'tab'
          %li= link_to 'Volunteer Details', '#volunteers', 'data-toggle' => 'tab'
          %li= link_to 'Staff Details', '#staff', 'data-toggle' => 'tab'
          %li= link_to 'Groups', '#groups', 'data-toggle' => 'tab'
          %li= link_to 'Photos', '#photos', 'data-toggle' => 'tab'
          %li= link_to 'Files', '#documents', 'data-toggle' => 'tab'
          %li= link_to 'Pages', '#pages', 'data-toggle' => 'tab'
          %li= link_to 'Case Studies', '#case_studies', 'data-toggle' => 'tab'
          %li= link_to 'Timeline events', '#moments', 'data-toggle' => 'tab'
          %li= link_to 'Libraries', '#libraries', 'data-toggle' => 'tab'
        .tab-content
          .tab-pane#user.active
            %p= Carmen.country_name(@user.country) if @user.country
            - if can? :read, @user
              %h3 Connect
              %p
                = @user.email
                - unless @user.email2.nil?
                  %br
                  = @user.email2
              - unless @user.phone1.nil?
                %p
                  = @user.phone1
                  - unless @user.phone2.nil?
                    %br
                    = @user.phone2
            - else
              %h4 Please indicate that you are a member of a Peace Corps post to access contact information.
            - if @user.blogs.any?
              %p #{link_to @user.blogs.first.title, @user.blogs.first.url} &rang; #{@user.blogs.first.description}
            - unless @user.site.nil?
              %p= link_to @user.site
            - if @user.bio
              .well
                %h4 A little bit about #{@user.name}...
                = markdown(@user.bio)
          .tab-pane#volunteers
            - if can?(:read, Volunteer) && @user.volunteers.any?
              - @user.volunteers.each do |v|
                .well
                  %h1
                    = flag_icon(v.country)
                    = v.local_name
                    %small
                      = link_to 'destroy', v, confirm: 'Are you sure?', method: :delete if can? :destroy, v
                      = link_to 'edit', edit_volunteer_path(v) if can? :manage, Volunteer
                  %div
                    %p
                      = "#{v.sector.name} Volunteer" if v.sector
                      %br
                      = Carmen.country_name(v.country) if v.country
                      %br
                      = v.stage.name if v.stage
                    %h4 Site
                    %p= v.site.name if v.site
                    - if v.emphasis
                      %h4 Emphasis
                      %p= v.emphasis
                    - if v.projects
                      %h4 Projects
                      %p= v.projects
            - elsif can? :read, Volunteer
              .well
                %p This user is not currently registered as a Peace Corps Volunteer. If you believe this is an error, please #{link_to 'let us know', 'feedback/volunteer_request'}.
            - else
              .well
                You do not have permission to view this user's details.
          .tab-pane#staff
            - if can?(:read, Staff) && @user.staff.any?
              - @user.staff.each do |s|
                .well
                  %h3
                    = flag_icon(s.country)
                    Staff Member
                    %small
                      = link_to 'destroy', s, confirm: 'Are you sure?', method: :delete if can? :destroy, s
                      = link_to 'edit', edit_staff_path(s) if can? :manage, Staff
                  %h4= s.site.name if s.site
                  %p= Carmen.country_name(s.country) if s.country
                  %p
                    = s.building
                    = "| #{s.office}" if s.office
                    = "| #{s.floor.to_i.ordinalize} floor" if s.floor
                  -if s.morning_open
                    %p
                      = s.morning_open.to_formatted_s(format = :time)
                      \-
                      = s.morning_close.to_formatted_s(format = :time)
                      %br
                      = s.afternoon_open.to_formatted_s(format = :time)
                      \-
                      = s.afternoon_close.to_formatted_s(format = :time)
                  = markdown(s.details) if s.details
            - elsif can? :read, Staff
              %p This user is not currently registered as a Peace Corps Staff member. If you believe this is an error, please #{link_to 'let us know', 'feedback/volunteer_request'}.
            - else
              %p You do not have permission to view this user's details. Most likely, this means that you are neither a Peace Corps Volunter nor Staff member. If you believe this is an error, please #{link_to 'let us know', 'feedback/volunteer_request'}.
          .tab-pane#groups
            %h3 Groups
            %ul
              - @user.roles.each do |role|
                %li= role.name
          .tab-pane#photos
            - if @user.photos.any?
              .box
                %h3 Recently Uploaded Photos
                - @user.photos.limit(5).each do |p|
                  = render p
            - else
              %p This user has not uploaded any photos.
          .tab-pane#documents
            - if @user.documents.any?
              .box
                %h3 Recently Uploaded Files
                %ul.feed
                  = render @user.documents.limit(5)
            - else
              %p This user has not uploaded any files.
          .tab-pane#pages
            - if (contributions = @user.contributions.where(:contributable_type => 'Page').limit(10)).any?
              .box
                %h3 Pages
                %ul.feed
                  - contributions.each do |contribution|
                    = render contribution.contributable
            - else
              %p This user has neither created nor contributed to any pages.
          .tab-pane#case_studies
            - if (contributions = @user.contributions.where(:contributable_type => 'CaseStudy').limit(10)).any?
              .box
                %h3 Pages
                %ul.feed
                  - contributions.each do |contribution|
                    = render contribution.contributable
            - else
              %p This user has neither created nor contributed to any case studies.
          .tab-pane#moments
            - if @user.moments.any?
              .box.moments
                %h3 Timeline Events
                = render @user.moments
            - else
              %p This user has not submitted any events to the #{link_to 'timeline', moments_path}.
          .tab-pane#libraries
            - if @user.libraries.any?
              %ul= render @user.libraries
    .span2
      = avatar_for_user @user, :size => :small
      - if can? :update, @user
        .btn-group
          - unless @user.volunteers.any?
            = link_to "I'm a Volunteer!", volunteer_request_feedback_index_path, :class => 'btn'
          - else
            = link_to 'Edit profile', edit_user_path, :method => :get, :class => 'btn'
          %a.btn.dropdown-toggle{'data-toggle' => 'dropdown'}
            %span.caret
          %ul.dropdown-menu
            = link_to 'Edit profile', edit_user_path, :method => :get unless @user.volunteers.any?
            = link_to 'Change password', edit_user_registration_path
            = link_to "I'm a staff member!", volunteer_request_feedback_index_path, :class => 'btn' unless @user.staff.any?
        - if @user.avatar?
          = button_to 'Remove photo', remove_avatar_user_path, :method => :put, :remote => true, :disable_with => 'please wait...'
